# Vue Project Migration Summary

This document summarizes the migration of the orbat-mapper project to align with the latest `pnpm create vue@latest` scaffold defaults.

## Overview

The project has been updated to match the modern Vue 3 + Vite + TypeScript project structure generated by the official Vue scaffolding tool. This ensures consistency with current best practices and tooling standards.

## Key Changes

### 1. ESLint Configuration (NEW)

**Added:** `eslint.config.ts`
- Implements the new flat config format (ESLint 9+)
- Includes Vue, TypeScript, and Vitest plugin configurations
- Integrates Prettier for code formatting consistency
- Configures global ignores for build directories

**Package additions:**
- `eslint`: ^9.39.1
- `eslint-plugin-vue`: ~10.5.1
- `@vue/eslint-config-typescript`: ^14.6.0
- `@vue/eslint-config-prettier`: ^10.2.0
- `@vitest/eslint-plugin`: ^1.5.0
- `jiti`: ^2.6.1 (required for TS config loading)

**New script:** `pnpm run lint` - Runs ESLint with auto-fix and caching

### 2. TypeScript Configuration Updates

#### `tsconfig.json`
**Changes:**
- Removed `baseUrl` and `paths` from root config
- Added reference to `tsconfig.vitest.json`
- Simplified to only contain project references

**Reasoning:** The scaffold pattern moves path resolution to the app-specific config, keeping the root minimal.

#### `tsconfig.app.json`
**Changes:**
- Removed explicit `lib` field
- Inherits library configuration from `@vue/tsconfig/tsconfig.dom.json`

**Reasoning:** Reduces duplication; the base config already specifies appropriate libs.

#### `tsconfig.node.json`
**Changes:**
- Updated from `@tsconfig/node22` to `@tsconfig/node24`
- Removed explicit `lib` field
- Removed unnecessary library overrides

**Reasoning:** Aligns with latest Node.js LTS and reduces configuration noise.

#### `tsconfig.vitest.json` (NEW)
**Added:** Dedicated configuration for Vitest test files
- Extends `tsconfig.app.json`
- Includes test file patterns
- Configures `jsdom` and `node` types
- Separate build info file for test compilation

### 3. Vitest Configuration (NEW)

**Added:** `vitest.config.ts`
- Merges with main Vite config for consistency
- Configures `jsdom` environment for Vue component testing
- Excludes e2e tests from unit test runs
- Sets correct root directory

### 4. Vite Configuration

**Changes:**
- Reformatted to match scaffold style
- Single quotes instead of double quotes
- Consistent spacing and formatting
- Maintains all existing plugins (Vue, DevTools, Tailwind)

### 5. TypeScript Declaration Files

**Removed:** `src/shims-vue.d.ts`
**Added:** `env.d.ts` (project root)

**Changes:**
- Vue type declarations now handled by Volar/vue-tsc automatically
- Custom module declarations preserved and moved to `env.d.ts`
- Includes Vite client types reference

**Preserved custom declarations:**
- `formatcoords`
- `mgrs`
- `ol-ext/layer/GeoImage`
- `ol-ext/source/GeoImage`
- `ol-ext/interaction/Transform`
- `ol-ext/source/DayNight`

### 6. Package.json Updates

#### Scripts
**Added:**
- `lint`: ESLint with auto-fix and caching

**Note:** The `format` script remains unchanged from the original project.

#### Dev Dependencies - Version Updates
- `@vitejs/plugin-vue`: ^5.2.4 → ^6.0.2
- `@types/jsdom`: ^21.1.7 → ^27.0.0
- `@types/node`: ^22.19.3 → ^24.10.1
- `jsdom`: ^26.1.0 → ^27.2.0
- `npm-run-all2`: ^7.0.2 → ^8.0.4
- `prettier`: ^3.7.4 → 3.6.2 (exact version per scaffold)
- `typescript`: ^5.9.3 → ~5.9.0 (tilde per scaffold)
- `vite`: ^6.4.1 → ^7.2.4
- `vite-plugin-vue-devtools`: ^7.7.9 → ^8.0.5
- `vitest`: Moved from dependencies to devDependencies ^4.0.14
- `vue-tsc`: ^2.2.12 → ^3.1.5
- `@vue/tsconfig`: ^0.7.0 → ^0.8.1 (moved to devDependencies)

#### Dev Dependencies - New Additions
- `@vue/test-utils`: ^2.4.6 (testing utilities)
- `@vitest/eslint-plugin`: ^1.5.0
- `@vue/eslint-config-prettier`: ^10.2.0
- `@vue/eslint-config-typescript`: ^14.6.0
- `eslint`: ^9.39.1
- `eslint-plugin-vue`: ~10.5.1
- `jiti`: ^2.6.1

#### Engines
**Changed:**
- Old: `"node": ">= 20.10.0", "pnpm": ">= 10.25.0"`
- New: `"node": "^20.19.0 || >=22.12.0", "pnpm": ">=10.25.0"`

**Reasoning:** Aligns with scaffold's more specific Node version requirements while maintaining pnpm requirement.

### 7. Editor Configuration

#### `.editorconfig` (NEW)
Standardizes editor settings across the team:
- UTF-8 encoding
- 2-space indentation
- LF line endings
- Trim trailing whitespace
- 100 character line length

#### `.gitattributes` (NEW)
Ensures consistent line endings:
- Forces LF line endings for all text files

**Note:** `.vscode/` directory was not included per project requirements.

### 8. Git & Prettier Configuration

#### `.gitignore`
**Added patterns:**
- Comprehensive log file patterns
- Coverage directory
- `*.tsbuildinfo` files
- `.eslintcache`
- Cypress artifacts
- Vitest screenshots
- Editor directories (.vscode, .idea, etc.)

#### `.prettierrc` → `.prettierrc.json`
**Changes:**
- Migrated from JS to JSON format
- Added schema reference for IDE support
- Updated to match scaffold defaults:
  - `semi`: false
  - `singleQuote`: true
  - `printWidth`: 90 (preserved from original)
- Preserved `prettier-plugin-tailwindcss` plugin

## Breaking Changes & Migration Notes

### For Developers

1. **ESLint is now required**
   - Run `pnpm install` to get new ESLint dependencies
   - Run `pnpm run lint` before committing
   - ESLint will auto-fix many issues with the `--fix` flag

2. **TypeScript configuration is split**
   - Test files now use `tsconfig.vitest.json`
   - Node/config files use `tsconfig.node.json`
   - App code uses `tsconfig.app.json`
   - Root `tsconfig.json` is just project references

3. **Node.js version requirements**
   - Minimum: Node 20.19.0
   - Recommended: Node 22.12.0+
   - Update your Node version if needed

### Verification Steps

After pulling these changes:

```bash
# Install new dependencies
pnpm install

# Verify TypeScript compilation
pnpm run type-check

# Run linter
pnpm run lint

# Format code
pnpm run format

# Build project
pnpm run build

# Run tests
pnpm run test:unit

# Start dev server
pnpm run dev
```

## Files Added

- `eslint.config.ts` - ESLint flat config
- `env.d.ts` - TypeScript environment declarations
- `tsconfig.vitest.json` - Vitest TypeScript config
- `vitest.config.ts` - Vitest configuration
- `.editorconfig` - Editor configuration
- `.gitattributes` - Git line ending configuration
- `.prettierrc.json` - Prettier config (JSON format)
- `.vscode/extensions.json` - VSCode extension recommendations
- `.vscode/settings.json` - VSCode workspace settings

## Files Modified

- `package.json` - Updated dependencies, scripts, and engines
- `tsconfig.json` - Simplified to project references only
- `tsconfig.app.json` - Removed lib field, updated include
- `tsconfig.node.json` - Updated to node24, removed lib
- `vite.config.ts` - Reformatted to match scaffold style
- `.gitignore` - Added comprehensive patterns
- `.prettierignore` - No changes needed

## Files Removed

- `src/shims-vue.d.ts` - Replaced by `env.d.ts`
- `.prettierrc` - Replaced by `.prettierrc.json`

## Why These Changes?

1. **Consistency**: Matches what new Vue projects use by default
2. **Modern tooling**: Uses latest ESLint flat config, updated TypeScript patterns
3. **Better DX**: VSCode settings and extensions provide better development experience
4. **Maintainability**: Standard structure makes onboarding easier
5. **Performance**: Newer tool versions include performance improvements
6. **Type safety**: Proper test file TypeScript configuration

## Compatibility

- ✅ All existing code remains functional
- ✅ No changes to application logic
- ✅ Backward compatible with existing workflows
- ✅ Preserves all custom dependencies and configurations
- ⚠️ Requires Node.js 20.19.0+ (or 22.12.0+)
- ⚠️ Requires running `pnpm install` after pulling

## Future Improvements (Not Included)

These align with scaffold defaults but weren't strictly required:

- Vue Router integration already present ✓
- Pinia store integration already present ✓
- Vitest already configured ✓
- JSX support available via `@vitejs/plugin-vue-jsx` (not added as not currently used)
- Cypress/Playwright (not added as not currently needed)

## Questions or Issues?

If you encounter any issues after this migration:

1. Ensure you've run `pnpm install`
2. Clear any cached build artifacts: `rm -rf node_modules/.tmp dist`
3. Check Node.js version: `node --version`
4. Verify all new config files are present
5. Check for any local `.eslintrc*` files that might conflict

## References

- [Vue 3 Documentation](https://vuejs.org/)
- [Vite Documentation](https://vite.dev/)
- [ESLint Flat Config](https://eslint.org/docs/latest/use/configure/configuration-files)
- [TypeScript Project References](https://www.typescriptlang.org/docs/handbook/project-references.html)
- [Vitest Configuration](https://vitest.dev/config/)
